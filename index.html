<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Ping Pong Multiplayer</title>
    <style>
        body {
            margin: 0;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Courier New', monospace;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-size: clamp(1.5em, 4vw, 2.5em);
        }

        .connection-status {
            padding: 10px 20px;
            border-radius: 25px;
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
        }

        .status-connecting {
            background: rgba(255, 193, 7, 0.8);
            color: #000;
        }

        .status-waiting {
            background: rgba(23, 162, 184, 0.8);
            animation: pulse 2s infinite;
        }

        .status-connected {
            background: rgba(40, 167, 69, 0.8);
        }

        .status-disconnected {
            background: rgba(220, 53, 69, 0.8);
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .game-container {
            border: 4px solid white;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.2);
            margin: 0 auto;
            max-width: 100%;
            overflow: hidden;
        }

        canvas {
            display: block;
            background: #000;
            border-radius: 6px;
            max-width: 100%;
            height: auto;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin: 15px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .score {
            font-size: clamp(24px, 6vw, 48px);
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            text-align: center;
        }

        .player-info {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            min-width: 120px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .player-controls {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            font-size: clamp(12px, 2.5vw, 14px);
        }

        .instructions {
            text-align: center;
            margin: 15px 0;
            font-size: clamp(14px, 3vw, 16px);
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            max-width: 800px;
        }

        .room-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.5);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .fullscreen-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .fullscreen-active {
            background: rgba(40, 167, 69, 0.8) !important;
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: clamp(14px, 3vw, 16px);
            cursor: pointer;
            transition: transform 0.2s;
            font-family: inherit;
        }

        button:hover:not(:disabled) {
            transform: scale(1.05);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        input {
            padding: 10px 15px;
            border: none;
            border-radius: 25px;
            font-size: clamp(14px, 3vw, 16px);
            text-align: center;
            max-width: 200px;
        }

        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            font-size: clamp(18px, 4vw, 24px);
            display: none;
            border: 3px solid #fff;
            z-index: 1000;
            max-width: 90vw;
        }

        .room-info {
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: clamp(12px, 2.5vw, 14px);
        }

        @media (max-width: 768px) {
            .game-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .controls {
                gap: 15px;
            }
            
            .room-controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <button class="fullscreen-btn" id="fullscreenBtn" onclick="toggleFullscreen()" title="Toggle Fullscreen">‚õ∂</button>
    
    <h1>üèì ONLINE PING PONG üèì</h1>
    
    <div class="connection-status status-connecting" id="connectionStatus">
        Connecting to server...
    </div>

    <div class="room-controls" id="roomControls">
        <input type="text" id="roomInput" placeholder="Enter room code" maxlength="10">
        <button onclick="joinRoom()">Join Room</button>
        <button onclick="createRoom()">Create Room</button>
    </div>

    <div class="room-info" id="roomInfo" style="display: none;">
        Room: <span id="currentRoom"></span> | Players: <span id="playerCount">0</span>/2
    </div>

    <div class="game-info">
        <div class="player-info">
            <h3 id="player1Name">Player 1</h3>
            <div class="score" id="player1Score">0</div>
        </div>
        <div class="player-info">
            <h3>VS</h3>
        </div>
        <div class="player-info">
            <h3 id="player2Name">Player 2</h3>
            <div class="score" id="player2Score">0</div>
        </div>
    </div>

    <div class="game-container">
        <canvas id="gameCanvas" width="1200" height="600"></canvas>
    </div>

    <div class="controls">
        <div class="player-controls">
            <h4>Controls</h4>
            <p>W / ‚Üë - Move Up</p>
            <p>S / ‚Üì - Move Down</p>
            <p>SPACE - Ready/Restart</p>
        </div>
    </div>

    <div class="instructions">
        <p>Join a room or create your own to play with friends! First to 7 points wins. The game starts when both players are ready.</p>
    </div>

    <div class="game-over" id="gameOver">
        <h2 id="winnerText">Player Wins!</h2>
        <button onclick="readyUp()">Play Again</button>
    </div>

    <script>
        // Game configuration
        const CANVAS_WIDTH = 1200;
        const CANVAS_HEIGHT = 600;
        const WINNING_SCORE = 7;
        const BALL_SPEED = 3; // Starting ball speed
        const BALL_ACCELERATION = 0.3; // Speed increase per bounce
        const MAX_BALL_SPEED = 12; // Maximum ball speed
        const PADDLE_SPEED = 6;

        // Canvas setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Scale canvas for mobile devices
        function resizeCanvas() {
            const container = canvas.parentElement;
            const containerWidth = container.clientWidth - 8; // Account for border
            const scale = Math.min(1, containerWidth / CANVAS_WIDTH);
            
            canvas.style.width = (CANVAS_WIDTH * scale) + 'px';
            canvas.style.height = (CANVAS_HEIGHT * scale) + 'px';
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Game state
        let gameState = {
            ball: {
                x: CANVAS_WIDTH / 2,
                y: CANVAS_HEIGHT / 2,
                dx: BALL_SPEED,
                dy: 2,
                radius: 10,
                speed: BALL_SPEED
            },
            paddle1: {
                x: 30,
                y: CANVAS_HEIGHT / 2 - 75,
                width: 20,
                height: 150,
                speed: PADDLE_SPEED
            },
            paddle2: {
                x: CANVAS_WIDTH - 50,
                y: CANVAS_HEIGHT / 2 - 75,
                width: 20,
                height: 150,
                speed: PADDLE_SPEED
            },
            player1Score: 0,
            player2Score: 0,
            gameRunning: false,
            playerId: null,
            playerNumber: null,
            ready: false,
            bothReady: false
        };

        // Input handling
        let keys = {};
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.code === 'Space') {
                e.preventDefault();
                readyUp();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // WebSocket connection (simulated with local state for demo)
        let ws = null;
        let connectionState = 'connecting';
        let currentRoom = null;
        let playerCount = 0;

        // Simulate WebSocket functionality for demo
        function initializeWebSocket() {
            // In a real implementation, this would connect to a WebSocket server
            // For demo purposes, we'll simulate the connection process
            
            setTimeout(() => {
                setConnectionStatus('waiting', 'Ready to create or join rooms');
                // Keep room controls visible
            }, 1000);
        }

        function enableLocalMultiplayer() {
            gameState.playerNumber = 1;
            gameState.playerId = 'local1';
            playerCount = 2;
            updatePlayerCount();
            setConnectionStatus('connected', 'Local multiplayer mode - Both players ready!');
            
            // Enable the game after a short delay
            setTimeout(() => {
                gameState.bothReady = true;
            }, 500);
        }

        function setConnectionStatus(status, message) {
            const statusEl = document.getElementById('connectionStatus');
            statusEl.className = `connection-status status-${status}`;
            statusEl.textContent = message;
            connectionState = status;
        }

        function createRoom() {
            const roomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
            
            // Show the generated room code
            document.getElementById('roomInput').value = roomCode;
            
            currentRoom = roomCode;
            document.getElementById('currentRoom').textContent = roomCode;
            document.getElementById('roomInfo').style.display = 'block';
            
            // Keep room controls visible but disable them
            const joinBtn = document.querySelector('button[onclick="joinRoom()"]');
            const createBtn = document.querySelector('button[onclick="createRoom()"]');
            joinBtn.disabled = true;
            createBtn.disabled = true;
            joinBtn.textContent = 'Room Created';
            
            gameState.playerNumber = 1;
            gameState.playerId = 'host';
            playerCount = 1;
            updatePlayerCount();
            setConnectionStatus('waiting', `Room ${roomCode} created! Share this code with a friend.`);
            
            // Simulate second player joining after 5 seconds (for demo)
            setTimeout(() => {
                if (playerCount === 1) {
                    playerCount = 2;
                    updatePlayerCount();
                    setConnectionStatus('connected', 'Player 2 joined the room!');
                    enableLocalMultiplayer();
                }
            }, 5000);
        }

        function joinRoom(roomCode) {
            if (!roomCode) {
                roomCode = document.getElementById('roomInput').value.trim().toUpperCase();
            }
            
            if (!roomCode) {
                alert('Please enter a room code');
                return;
            }

            currentRoom = roomCode;
            document.getElementById('currentRoom').textContent = roomCode;
            document.getElementById('roomInfo').style.display = 'block';
            
            // Disable room controls
            const joinBtn = document.querySelector('button[onclick="joinRoom()"]');
            const createBtn = document.querySelector('button[onclick="createRoom()"]');
            const roomInput = document.getElementById('roomInput');
            joinBtn.disabled = true;
            createBtn.disabled = true;
            roomInput.disabled = true;
            joinBtn.textContent = 'Joining...';
            
            gameState.playerNumber = 2;
            gameState.playerId = 'player2';
            playerCount = 2;
            updatePlayerCount();
            setConnectionStatus('connected', `Joined room ${roomCode}!`);
            
            // Enable game immediately when joining
            setTimeout(() => {
                enableLocalMultiplayer();
            }, 1000);
        }

        function updatePlayerCount() {
            document.getElementById('playerCount').textContent = playerCount;
        }

        // Fullscreen functionality
        function toggleFullscreen() {
            const btn = document.getElementById('fullscreenBtn');
            
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().then(() => {
                    btn.classList.add('fullscreen-active');
                    btn.innerHTML = '‚úï';
                    resizeCanvas();
                }).catch(err => {
                    console.log('Error attempting to enable fullscreen:', err);
                });
            } else {
                document.exitFullscreen().then(() => {
                    btn.classList.remove('fullscreen-active');
                    btn.innerHTML = '‚õ∂';
                    resizeCanvas();
                });
            }
        }

        // Listen for fullscreen changes
        document.addEventListener('fullscreenchange', () => {
            const btn = document.getElementById('fullscreenBtn');
            if (!document.fullscreenElement) {
                btn.classList.remove('fullscreen-active');
                btn.innerHTML = '‚õ∂';
            }
            resizeCanvas();
        });

        function readyUp() {
            if (playerCount < 2) {
                alert('Waiting for another player to join!');
                return;
            }
            
            gameState.ready = !gameState.ready;
            
            // Update button text based on ready state
            const gameOverDiv = document.getElementById('gameOver');
            if (gameOverDiv.style.display !== 'block') {
                setConnectionStatus('connected', 
                    gameState.ready ? 'You are ready! Waiting for other player...' : 'Press SPACE when ready to play!'
                );
            }
            
            // Simulate both players ready for demo
            if (gameState.ready) {
                setTimeout(() => {
                    gameState.bothReady = true;
                    setConnectionStatus('connected', 'Both players ready! Game starting...');
                    startGame();
                }, 1500);
            }
        }

        function startGame() {
            if (!gameState.bothReady) return;
            
            gameState.gameRunning = true;
            document.getElementById('gameOver').style.display = 'none';
            resetBall();
        }

        function resetBall() {
            gameState.ball.x = CANVAS_WIDTH / 2;
            gameState.ball.y = CANVAS_HEIGHT / 2;
            gameState.ball.dx = (Math.random() > 0.5 ? 1 : -1) * BALL_SPEED;
            gameState.ball.dy = (Math.random() - 0.5) * BALL_SPEED * 0.8;
            gameState.ball.speed = BALL_SPEED;
        }

        function resetGame() {
            gameState.player1Score = 0;
            gameState.player2Score = 0;
            gameState.ready = false;
            gameState.bothReady = false;
            updateScore();
            resetBall();
        }

        function updateScore() {
            document.getElementById('player1Score').textContent = gameState.player1Score;
            document.getElementById('player2Score').textContent = gameState.player2Score;
        }

        function checkCollision(rect, circle) {
            const distX = Math.abs(circle.x - rect.x - rect.width/2);
            const distY = Math.abs(circle.y - rect.y - rect.height/2);

            if (distX > (rect.width/2 + circle.radius)) return false;
            if (distY > (rect.height/2 + circle.radius)) return false;

            if (distX <= (rect.width/2)) return true;
            if (distY <= (rect.height/2)) return true;

            const dx = distX - rect.width/2;
            const dy = distY - rect.height/2;
            return (dx*dx + dy*dy <= (circle.radius*circle.radius));
        }

        function update() {
            if (!gameState.gameRunning) return;

            // Handle input for both players in local mode
            if (keys['w'] || keys['W'] || keys['ArrowUp']) {
                gameState.paddle1.y = Math.max(0, gameState.paddle1.y - gameState.paddle1.speed);
            }
            if (keys['s'] || keys['S'] || keys['ArrowDown']) {
                gameState.paddle1.y = Math.min(CANVAS_HEIGHT - gameState.paddle1.height, gameState.paddle1.y + gameState.paddle1.speed);
            }

            // Second paddle (local multiplayer)
            if (connectionState === 'connected' && playerCount === 2) {
                // Simple AI for demonstration
                const paddleCenter = gameState.paddle2.y + gameState.paddle2.height / 2;
                const ballY = gameState.ball.y;
                
                if (ballY < paddleCenter - 10) {
                    gameState.paddle2.y = Math.max(0, gameState.paddle2.y - gameState.paddle2.speed * 0.7);
                } else if (ballY > paddleCenter + 10) {
                    gameState.paddle2.y = Math.min(CANVAS_HEIGHT - gameState.paddle2.height, gameState.paddle2.y + gameState.paddle2.speed * 0.7);
                }
            }

            // Ball movement
            gameState.ball.x += gameState.ball.dx;
            gameState.ball.y += gameState.ball.dy;

            // Ball collision with top and bottom walls
            if (gameState.ball.y - gameState.ball.radius <= 0 || gameState.ball.y + gameState.ball.radius >= CANVAS_HEIGHT) {
                gameState.ball.dy = -gameState.ball.dy;
            }

            // Ball collision with paddles
            if (checkCollision(gameState.paddle1, gameState.ball)) {
                if (gameState.ball.dx < 0) {
                    gameState.ball.dx = -gameState.ball.dx;
                    gameState.ball.dy += (gameState.ball.y - (gameState.paddle1.y + gameState.paddle1.height/2)) * 0.1;
                    
                    // Increase ball speed after each bounce
                    gameState.ball.speed = Math.min(MAX_BALL_SPEED, gameState.ball.speed + BALL_ACCELERATION);
                    gameState.ball.dx = gameState.ball.dx > 0 ? gameState.ball.speed : -gameState.ball.speed;
                }
            }

            if (checkCollision(gameState.paddle2, gameState.ball)) {
                if (gameState.ball.dx > 0) {
                    gameState.ball.dx = -gameState.ball.dx;
                    gameState.ball.dy += (gameState.ball.y - (gameState.paddle2.y + gameState.paddle2.height/2)) * 0.1;
                    
                    // Increase ball speed after each bounce
                    gameState.ball.speed = Math.min(MAX_BALL_SPEED, gameState.ball.speed + BALL_ACCELERATION);
                    gameState.ball.dx = gameState.ball.dx > 0 ? gameState.ball.speed : -gameState.ball.speed;
                }
            }

            // Scoring
            if (gameState.ball.x < 0) {
                gameState.player2Score++;
                updateScore();
                checkWin();
                if (gameState.gameRunning) {
                    resetBall();
                }
            }

            if (gameState.ball.x > CANVAS_WIDTH) {
                gameState.player1Score++;
                updateScore();
                checkWin();
                if (gameState.gameRunning) {
                    resetBall();
                }
            }
        }

        function checkWin() {
            if (gameState.player1Score >= WINNING_SCORE) {
                endGame("Player 1 Wins!");
            } else if (gameState.player2Score >= WINNING_SCORE) {
                endGame("Player 2 Wins!");
            }
        }

        function endGame(winnerText) {
            gameState.gameRunning = false;
            gameState.bothReady = false;
            document.getElementById('winnerText').textContent = winnerText;
            document.getElementById('gameOver').style.display = 'block';
        }

        function draw() {
            // Clear canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // Draw center line
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 3;
            ctx.setLineDash([15, 15]);
            ctx.beginPath();
            ctx.moveTo(CANVAS_WIDTH / 2, 0);
            ctx.lineTo(CANVAS_WIDTH / 2, CANVAS_HEIGHT);
            ctx.stroke();
            ctx.setLineDash([]);

            // Draw paddles
            ctx.fillStyle = '#fff';
            ctx.fillRect(gameState.paddle1.x, gameState.paddle1.y, gameState.paddle1.width, gameState.paddle1.height);
            ctx.fillRect(gameState.paddle2.x, gameState.paddle2.y, gameState.paddle2.width, gameState.paddle2.height);

            // Draw ball
            ctx.beginPath();
            ctx.arc(gameState.ball.x, gameState.ball.y, gameState.ball.radius, 0, Math.PI * 2);
            ctx.fill();

            // Add glow effect to ball
            ctx.shadowColor = '#fff';
            ctx.shadowBlur = 25;
            ctx.beginPath();
            ctx.arc(gameState.ball.x, gameState.ball.y, gameState.ball.radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;

            // Draw speed indicator
            if (gameState.gameRunning) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.font = '20px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText(`Speed: ${gameState.ball.speed.toFixed(1)}`, CANVAS_WIDTH / 2, 40);
                
                // Speed meter bar
                const barWidth = 200;
                const barHeight = 8;
                const barX = (CANVAS_WIDTH - barWidth) / 2;
                const barY = 50;
                const speedPercentage = Math.min(1, (gameState.ball.speed - BALL_SPEED) / (MAX_BALL_SPEED - BALL_SPEED));
                
                // Background bar
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.fillRect(barX, barY, barWidth, barHeight);
                
                // Speed bar
                ctx.fillStyle = `hsl(${120 - speedPercentage * 60}, 80%, 60%)`;
                ctx.fillRect(barX, barY, barWidth * speedPercentage, barHeight);
                
                ctx.textAlign = 'left';
            }
            if (!gameState.gameRunning && playerCount >= 2) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.font = '32px Courier New';
                ctx.textAlign = 'center';
                
                if (!gameState.bothReady) {
                    ctx.fillText('Press SPACE when ready!', CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2);
                }
                ctx.textAlign = 'left';
            }

            // Draw waiting message
            if (playerCount < 2) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.font = '28px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText('Waiting for another player...', CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2);
                ctx.textAlign = 'left';
            }
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Initialize game
        initializeWebSocket();
        gameLoop();
    </script>
</body>
</html>
